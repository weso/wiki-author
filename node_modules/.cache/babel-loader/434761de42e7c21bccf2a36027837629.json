{"ast":null,"code":"import _slicedToArray from \"/home/mistermboy/repositories/wiki-author/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/mistermboy/repositories/wiki-author/src/components/mainComps/EditorComp.js\";\nimport React, { useState, useContext, useEffect, useRef } from 'react';\nimport 'yashe/dist/yashe.min.css';\nimport { AppContext } from '../../App';\nimport { DEFAULTS } from '../../conf/config';\nimport CodeMirror from 'codemirror';\nimport YASHE from 'yashe';\nimport Editor from '../../entities/editor';\nimport yasheUtils from '../../utils/yasheUtils';\nimport Prefix from '../../entities/shexEntities/shexUtils/prefix';\nimport '../../css/Yashe.css';\nimport '../../css/themes/author.css';\nimport '../../css/themes/author-dark.css';\nconst ERROR_EDITOR_MSG = 'Ops... There are some errors in the editor';\nconst COMPLEX_SHAPE_MSG = 'Sorry that Shape is too complex for me';\n\nfunction EditorComp() {\n  const _useState = useState(null),\n        _useState2 = _slicedToArray(_useState, 2),\n        yashe = _useState2[0],\n        setYashe = _useState2[1];\n\n  const divRef = useRef(null);\n  const context = useContext(AppContext);\n  let oldShapes = [];\n  let isComplex = false;\n  const defaultPrefixes = [new Prefix('', 'http://example.org/', 0), new Prefix('schema', 'http://schema.org/', 1), new Prefix('xsd', 'http://www.w3.org/2001/XMLSchema#', 2)];\n  useEffect(() => {\n    if (!yashe) {\n      const options = {\n        persistent: false,\n        lineNumbers: true,\n        showTooltip: true,\n        theme: 'author-dark',\n        value: yasheUtils.DEFAULT_SHAPE\n      };\n      const y = YASHE(divRef.current, options);\n      y.on('humanEvent', function (shapes, width) {\n        Editor.getInstance().draw(shapes); //console.log(shapes)\n\n        isComplex = false;\n        oldShapes = shapes;\n        let data = {\n          size: {\n            width: width\n          }\n        };\n        context.handleResize(null, data);\n      });\n      y.on('convert', function () {\n        if (!y.hasErrors(y)) {\n          hideError();\n          updateAssist();\n        } else {\n          hideError();\n          hideConvert();\n          loading();\n          setTimeout(function () {\n            loaded();\n            showConvert();\n            showError(ERROR_EDITOR_MSG);\n          }, 500);\n        }\n      }); //When the sinc is activated we activate the appropriate handlers \n      //Otherwise it will be desactivated\n\n      y.on('sinc', function (sinc) {\n        if (sinc) {\n          y._handlers.focus = null;\n          hideConvert();\n          if (isComplex) showError(COMPLEX_SHAPE_MSG);\n          if (y.hasErrors(y)) showError(ERROR_EDITOR_MSG);\n          y.on('keyup', yasheUtils.debounce(function (e) {\n            if (!y.hasErrors(y)) {\n              hideError();\n              let newShapes = getNewShapes();\n\n              if (oldShapes.length == newShapes.length) {\n                //Any new shape?\n                if (newShapes.toString() != oldShapes.toString()) {\n                  //Any cupdate?\n                  isComplex = false;\n                  oldShapes = replaceShapes(newShapes);\n                }\n              } else {\n                updateAssist();\n              }\n            } else {\n              showError(ERROR_EDITOR_MSG);\n            }\n          }, 500)); //Fired after a key is handled through a key map\n          //(for example \"Ctrl-Z\")\n\n          y.on('keyHandled', function () {\n            if (!y.hasErrors()) {\n              isComplex = false;\n              oldShapes = replaceShapes(getNewShapes());\n              updatePrefixes(getNewPrefixes());\n            }\n          });\n        } else {\n          //Not really elegant I know     \n          y._handlers.keyup = null;\n          y._handlers.keyHandled = null;\n          if (y.hasErrors(y)) showConvert();\n          if (isComplex) showConvert();\n          y.on('focus', function () {\n            showConvert();\n          });\n        }\n      });\n      y.on('prefixChange', function (prefixes, width) {\n        Editor.getInstance().draw(oldShapes, prefixes);\n        let data = {\n          size: {\n            width: width\n          }\n        };\n        context.handleResize(null, data);\n      });\n      y.on('forceError', function (prefixes) {\n        isComplex = true;\n        hideError();\n        loading();\n        setTimeout(function () {\n          loaded();\n          showError(COMPLEX_SHAPE_MSG);\n          if (!DEFAULTS.sincronize) showConvert();\n        }, 500);\n      });\n      y.on('delete', function () {\n        isComplex = false;\n        oldShapes = replaceShapes(getNewShapes());\n        updatePrefixes(defaultPrefixes);\n      });\n      y.on('upload', function () {\n        if (!y.hasErrors()) {\n          updateAssist();\n          updatePrefixes(getNewPrefixes());\n        }\n      }); //Load example from Galery\n\n      y.on('galery', function () {\n        if (!y.hasErrors()) {\n          updateAssist();\n          updatePrefixes(getNewPrefixes());\n        }\n      });\n      y.refresh();\n      setYashe(y);\n      Editor.getInstance().setYashe(y);\n      oldShapes = replaceShapes(getNewShapes());\n      updatePrefixes(defaultPrefixes);\n      CodeMirror.signal(Editor.getInstance().getYashe(), 'sinc', DEFAULTS.sincronize);\n    }\n  }, [yashe]);\n\n  const getNewShapes = function () {\n    return yasheUtils.replaceShapes();\n  };\n\n  const getNewPrefixes = function () {\n    return yasheUtils.updatePrefixes();\n  };\n\n  const replaceShapes = newShapes => {\n    context.replaceShapes(newShapes);\n    return newShapes;\n  };\n\n  const updatePrefixes = newPrefixes => {\n    context.replacePrefixes(newPrefixes);\n    return newPrefixes;\n  };\n\n  const updateAssist = function () {\n    hideConvert();\n    loading();\n    setTimeout(function () {\n      isComplex = false;\n      oldShapes = replaceShapes(getNewShapes());\n      loaded();\n    }, 500);\n  };\n\n  const animate = function (before1, after1, before2, after2) {\n    let e1 = document.getElementsByClassName(before1)[0];\n    if (e1) e1.className = after1;\n    let e2 = document.getElementsByClassName(before2)[0];\n    if (e2) e2.className = after2;\n  };\n\n  const loading = function () {\n    animate('showAsist', 'hideAsist', 'hideLoader', 'showLoader');\n  };\n\n  const loaded = function () {\n    animate('showLoader', 'hideLoader', 'hideAsist', 'showAsist');\n  };\n\n  const showError = function (err) {\n    animate('hideError', 'showError', 'showAsist', 'hideAsist');\n    document.getElementsByClassName('errorMsg')[0].textContent = err;\n  };\n\n  const showConvert = function (err) {\n    animate('hideConvert', 'showConvert', 'showAsist', 'hideAsist');\n  };\n\n  const hideError = function () {\n    animate('showError', 'hideError', 'hideAsist', 'showAsist');\n  };\n\n  const hideConvert = function () {\n    animate('showConvert', 'hideConvert', 'hideAsist', 'showAsist');\n  };\n\n  return React.createElement(\"div\", {\n    className: \"col edit\",\n    ref: divRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243\n    },\n    __self: this\n  });\n}\n\nexport default EditorComp;","map":{"version":3,"sources":["/home/mistermboy/repositories/wiki-author/src/components/mainComps/EditorComp.js"],"names":["React","useState","useContext","useEffect","useRef","AppContext","DEFAULTS","CodeMirror","YASHE","Editor","yasheUtils","Prefix","ERROR_EDITOR_MSG","COMPLEX_SHAPE_MSG","EditorComp","yashe","setYashe","divRef","context","oldShapes","isComplex","defaultPrefixes","options","persistent","lineNumbers","showTooltip","theme","value","DEFAULT_SHAPE","y","current","on","shapes","width","getInstance","draw","data","size","handleResize","hasErrors","hideError","updateAssist","hideConvert","loading","setTimeout","loaded","showConvert","showError","sinc","_handlers","focus","debounce","e","newShapes","getNewShapes","length","toString","replaceShapes","updatePrefixes","getNewPrefixes","keyup","keyHandled","prefixes","sincronize","refresh","signal","getYashe","newPrefixes","replacePrefixes","animate","before1","after1","before2","after2","e1","document","getElementsByClassName","className","e2","err","textContent"],"mappings":";;AAAA,OAAOA,KAAP,IAAeC,QAAf,EAAwBC,UAAxB,EAAmCC,SAAnC,EAA6CC,MAA7C,QAA0D,OAA1D;AACA,OAAO,0BAAP;AACA,SAAQC,UAAR,QAAyB,WAAzB;AACA,SAAQC,QAAR,QAAuB,mBAAvB;AAEA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,uBAAnB;AAEA,OAAOC,UAAP,MAAuB,wBAAvB;AACA,OAAOC,MAAP,MAAmB,8CAAnB;AAEA,OAAO,qBAAP;AACA,OAAO,6BAAP;AACA,OAAO,kCAAP;AAEA,MAAMC,gBAAgB,GAAG,4CAAzB;AACA,MAAMC,iBAAiB,GAAG,wCAA1B;;AAEA,SAASC,UAAT,GAAsB;AAAA,oBAEOb,QAAQ,CAAC,IAAD,CAFf;AAAA;AAAA,QAEXc,KAFW;AAAA,QAELC,QAFK;;AAGlB,QAAMC,MAAM,GAAGb,MAAM,CAAC,IAAD,CAArB;AACA,QAAMc,OAAO,GAAGhB,UAAU,CAACG,UAAD,CAA1B;AACA,MAAIc,SAAS,GAAG,EAAhB;AACA,MAAIC,SAAS,GAAG,KAAhB;AAGA,QAAMC,eAAe,GAAG,CACZ,IAAIV,MAAJ,CAAW,EAAX,EAAc,qBAAd,EAAoC,CAApC,CADY,EAEZ,IAAIA,MAAJ,CAAW,QAAX,EAAoB,oBAApB,EAAyC,CAAzC,CAFY,EAGZ,IAAIA,MAAJ,CAAW,KAAX,EAAiB,mCAAjB,EAAqD,CAArD,CAHY,CAAxB;AAMAR,EAAAA,SAAS,CAAC,MAAM;AAEZ,QAAI,CAACY,KAAL,EAAY;AACR,YAAMO,OAAO,GAAG;AACZC,QAAAA,UAAU,EAAC,KADC;AAEZC,QAAAA,WAAW,EAAE,IAFD;AAGZC,QAAAA,WAAW,EAAC,IAHA;AAIZC,QAAAA,KAAK,EAAC,aAJM;AAKZC,QAAAA,KAAK,EAACjB,UAAU,CAACkB;AALL,OAAhB;AAQA,YAAMC,CAAC,GAAGrB,KAAK,CAACS,MAAM,CAACa,OAAR,EAAgBR,OAAhB,CAAf;AAGAO,MAAAA,CAAC,CAACE,EAAF,CAAK,YAAL,EAAmB,UAASC,MAAT,EAAgBC,KAAhB,EAAuB;AACtCxB,QAAAA,MAAM,CAACyB,WAAP,GAAqBC,IAArB,CAA0BH,MAA1B,EADsC,CAEtC;;AACAZ,QAAAA,SAAS,GAAC,KAAV;AACAD,QAAAA,SAAS,GAAGa,MAAZ;AACA,YAAII,IAAI,GAAC;AAACC,UAAAA,IAAI,EAAC;AAACJ,YAAAA,KAAK,EAACA;AAAP;AAAN,SAAT;AACAf,QAAAA,OAAO,CAACoB,YAAR,CAAqB,IAArB,EAA0BF,IAA1B;AACH,OAPD;AASAP,MAAAA,CAAC,CAACE,EAAF,CAAK,SAAL,EAAe,YAAU;AACrB,YAAG,CAACF,CAAC,CAACU,SAAF,CAAYV,CAAZ,CAAJ,EAAmB;AACfW,UAAAA,SAAS;AACTC,UAAAA,YAAY;AACf,SAHD,MAGK;AACDD,UAAAA,SAAS;AACTE,UAAAA,WAAW;AACXC,UAAAA,OAAO;AACPC,UAAAA,UAAU,CAAC,YAAW;AAClBC,YAAAA,MAAM;AACNC,YAAAA,WAAW;AACXC,YAAAA,SAAS,CAACnC,gBAAD,CAAT;AACH,WAJS,EAIR,GAJQ,CAAV;AAKH;AACJ,OAdD,EArBQ,CAqCR;AACA;;AACAiB,MAAAA,CAAC,CAACE,EAAF,CAAK,MAAL,EAAa,UAASiB,IAAT,EAAe;AACxB,YAAGA,IAAH,EAAQ;AACJnB,UAAAA,CAAC,CAACoB,SAAF,CAAYC,KAAZ,GAAoB,IAApB;AACAR,UAAAA,WAAW;AACX,cAAGtB,SAAH,EAAa2B,SAAS,CAAClC,iBAAD,CAAT;AACb,cAAGgB,CAAC,CAACU,SAAF,CAAYV,CAAZ,CAAH,EAAkBkB,SAAS,CAACnC,gBAAD,CAAT;AAElBiB,UAAAA,CAAC,CAACE,EAAF,CAAK,OAAL,EAAarB,UAAU,CAACyC,QAAX,CAAoB,UAAUC,CAAV,EAAc;AAC3C,gBAAG,CAACvB,CAAC,CAACU,SAAF,CAAYV,CAAZ,CAAJ,EAAmB;AACfW,cAAAA,SAAS;AACT,kBAAIa,SAAS,GAAGC,YAAY,EAA5B;;AACA,kBAAGnC,SAAS,CAACoC,MAAV,IAAoBF,SAAS,CAACE,MAAjC,EAAwC;AAAE;AACtC,oBAAGF,SAAS,CAACG,QAAV,MAAsBrC,SAAS,CAACqC,QAAV,EAAzB,EAA8C;AAAE;AAC5CpC,kBAAAA,SAAS,GAAC,KAAV;AACAD,kBAAAA,SAAS,GAAGsC,aAAa,CAACJ,SAAD,CAAzB;AACH;AACJ,eALD,MAKK;AACDZ,gBAAAA,YAAY;AACf;AACJ,aAXD,MAWK;AACDM,cAAAA,SAAS,CAACnC,gBAAD,CAAT;AACH;AACJ,WAfY,EAeV,GAfU,CAAb,EANI,CAuBH;AACD;;AACAiB,UAAAA,CAAC,CAACE,EAAF,CAAK,YAAL,EAAmB,YAAW;AAC1B,gBAAG,CAACF,CAAC,CAACU,SAAF,EAAJ,EAAkB;AACdnB,cAAAA,SAAS,GAAC,KAAV;AACAD,cAAAA,SAAS,GAAGsC,aAAa,CAACH,YAAY,EAAb,CAAzB;AACAI,cAAAA,cAAc,CAACC,cAAc,EAAf,CAAd;AACH;AACJ,WAND;AASH,SAlCD,MAkCK;AACD;AACA9B,UAAAA,CAAC,CAACoB,SAAF,CAAYW,KAAZ,GAAoB,IAApB;AACA/B,UAAAA,CAAC,CAACoB,SAAF,CAAYY,UAAZ,GAAyB,IAAzB;AACA,cAAGhC,CAAC,CAACU,SAAF,CAAYV,CAAZ,CAAH,EAAkBiB,WAAW;AAC7B,cAAG1B,SAAH,EAAa0B,WAAW;AACxBjB,UAAAA,CAAC,CAACE,EAAF,CAAK,OAAL,EAAc,YAAW;AACtBe,YAAAA,WAAW;AACb,WAFD;AAGH;AAEJ,OA9CD;AAgDAjB,MAAAA,CAAC,CAACE,EAAF,CAAK,cAAL,EAAqB,UAAS+B,QAAT,EAAkB7B,KAAlB,EAAyB;AAC1CxB,QAAAA,MAAM,CAACyB,WAAP,GAAqBC,IAArB,CAA0BhB,SAA1B,EAAoC2C,QAApC;AACA,YAAI1B,IAAI,GAAC;AAACC,UAAAA,IAAI,EAAC;AAACJ,YAAAA,KAAK,EAACA;AAAP;AAAN,SAAT;AACAf,QAAAA,OAAO,CAACoB,YAAR,CAAqB,IAArB,EAA0BF,IAA1B;AACH,OAJD;AAMAP,MAAAA,CAAC,CAACE,EAAF,CAAK,YAAL,EAAmB,UAAS+B,QAAT,EAAmB;AAClC1C,QAAAA,SAAS,GAAC,IAAV;AACAoB,QAAAA,SAAS;AACTG,QAAAA,OAAO;AACPC,QAAAA,UAAU,CAAC,YAAW;AAClBC,UAAAA,MAAM;AACNE,UAAAA,SAAS,CAAClC,iBAAD,CAAT;AACA,cAAG,CAACP,QAAQ,CAACyD,UAAb,EAAwBjB,WAAW;AACtC,SAJS,EAIR,GAJQ,CAAV;AAKH,OATD;AAWAjB,MAAAA,CAAC,CAACE,EAAF,CAAK,QAAL,EAAe,YAAW;AACtBX,QAAAA,SAAS,GAAC,KAAV;AACAD,QAAAA,SAAS,GAAGsC,aAAa,CAACH,YAAY,EAAb,CAAzB;AACAI,QAAAA,cAAc,CAACrC,eAAD,CAAd;AACH,OAJD;AAMAQ,MAAAA,CAAC,CAACE,EAAF,CAAK,QAAL,EAAe,YAAW;AACtB,YAAG,CAACF,CAAC,CAACU,SAAF,EAAJ,EAAkB;AACdE,UAAAA,YAAY;AACZiB,UAAAA,cAAc,CAACC,cAAc,EAAf,CAAd;AACH;AACJ,OALD,EA9GQ,CAuHR;;AACA9B,MAAAA,CAAC,CAACE,EAAF,CAAK,QAAL,EAAe,YAAW;AACtB,YAAG,CAACF,CAAC,CAACU,SAAF,EAAJ,EAAkB;AACdE,UAAAA,YAAY;AACZiB,UAAAA,cAAc,CAACC,cAAc,EAAf,CAAd;AACH;AACJ,OALD;AAQA9B,MAAAA,CAAC,CAACmC,OAAF;AACAhD,MAAAA,QAAQ,CAACa,CAAD,CAAR;AAEApB,MAAAA,MAAM,CAACyB,WAAP,GAAqBlB,QAArB,CAA8Ba,CAA9B;AAEAV,MAAAA,SAAS,GAAGsC,aAAa,CAACH,YAAY,EAAb,CAAzB;AACAI,MAAAA,cAAc,CAACrC,eAAD,CAAd;AAEAd,MAAAA,UAAU,CAAC0D,MAAX,CAAkBxD,MAAM,CAACyB,WAAP,GAAqBgC,QAArB,EAAlB,EAAkD,MAAlD,EAAyD5D,QAAQ,CAACyD,UAAlE;AACH;AACJ,GA5IQ,EA4IN,CAAChD,KAAD,CA5IM,CAAT;;AAiJA,QAAMuC,YAAY,GAAG,YAAW;AAC5B,WAAO5C,UAAU,CAAC+C,aAAX,EAAP;AACH,GAFD;;AAIA,QAAME,cAAc,GAAG,YAAW;AAC9B,WAAOjD,UAAU,CAACgD,cAAX,EAAP;AACH,GAFD;;AAIA,QAAMD,aAAa,GAAIJ,SAAD,IAAa;AAC/BnC,IAAAA,OAAO,CAACuC,aAAR,CAAsBJ,SAAtB;AACA,WAAOA,SAAP;AACH,GAHD;;AAKA,QAAMK,cAAc,GAAIS,WAAD,IAAe;AAClCjD,IAAAA,OAAO,CAACkD,eAAR,CAAwBD,WAAxB;AACA,WAAOA,WAAP;AACH,GAHD;;AAMA,QAAM1B,YAAY,GAAG,YAAU;AAC3BC,IAAAA,WAAW;AACXC,IAAAA,OAAO;AACPC,IAAAA,UAAU,CAAC,YAAW;AAClBxB,MAAAA,SAAS,GAAC,KAAV;AACAD,MAAAA,SAAS,GAAGsC,aAAa,CAACH,YAAY,EAAb,CAAzB;AACAT,MAAAA,MAAM;AACT,KAJS,EAIR,GAJQ,CAAV;AAKH,GARD;;AAWC,QAAMwB,OAAO,GAAG,UAASC,OAAT,EAAiBC,MAAjB,EAAwBC,OAAxB,EAAgCC,MAAhC,EAAuC;AACpD,QAAIC,EAAE,GAAGC,QAAQ,CAACC,sBAAT,CAAgCN,OAAhC,EAAyC,CAAzC,CAAT;AACA,QAAGI,EAAH,EAAOA,EAAE,CAACG,SAAH,GAAeN,MAAf;AACP,QAAIO,EAAE,GAAGH,QAAQ,CAACC,sBAAT,CAAgCJ,OAAhC,EAAyC,CAAzC,CAAT;AACA,QAAGM,EAAH,EAAOA,EAAE,CAACD,SAAH,GAAeJ,MAAf;AACT,GALD;;AAOD,QAAM9B,OAAO,GAAG,YAAU;AACtB0B,IAAAA,OAAO,CAAC,WAAD,EAAa,WAAb,EAAyB,YAAzB,EAAsC,YAAtC,CAAP;AACH,GAFD;;AAIA,QAAMxB,MAAM,GAAG,YAAU;AACpBwB,IAAAA,OAAO,CAAC,YAAD,EAAc,YAAd,EAA2B,WAA3B,EAAuC,WAAvC,CAAP;AACJ,GAFD;;AAIA,QAAMtB,SAAS,GAAG,UAASgC,GAAT,EAAa;AAC3BV,IAAAA,OAAO,CAAC,WAAD,EAAa,WAAb,EAAyB,WAAzB,EAAqC,WAArC,CAAP;AACAM,IAAAA,QAAQ,CAACC,sBAAT,CAAgC,UAAhC,EAA4C,CAA5C,EAA+CI,WAA/C,GAA6DD,GAA7D;AACH,GAHD;;AAKA,QAAMjC,WAAW,GAAG,UAASiC,GAAT,EAAa;AAC7BV,IAAAA,OAAO,CAAC,aAAD,EAAe,aAAf,EAA6B,WAA7B,EAAyC,WAAzC,CAAP;AACH,GAFD;;AAIA,QAAM7B,SAAS,GAAG,YAAU;AACxB6B,IAAAA,OAAO,CAAC,WAAD,EAAa,WAAb,EAAyB,WAAzB,EAAqC,WAArC,CAAP;AACH,GAFD;;AAIA,QAAM3B,WAAW,GAAG,YAAU;AAC1B2B,IAAAA,OAAO,CAAC,aAAD,EAAe,aAAf,EAA6B,WAA7B,EAAyC,WAAzC,CAAP;AACH,GAFD;;AAKA,SAAS;AAAK,IAAA,SAAS,EAAC,UAAf;AAA0B,IAAA,GAAG,EAAEpD,MAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAT;AAEH;;AAGD,eAAeH,UAAf","sourcesContent":["import React, {useState,useContext,useEffect,useRef} from 'react';\nimport 'yashe/dist/yashe.min.css';\nimport {AppContext} from '../../App';\nimport {DEFAULTS} from '../../conf/config';\n\nimport CodeMirror from 'codemirror';\nimport YASHE from 'yashe';\nimport Editor from '../../entities/editor';\n\nimport yasheUtils from '../../utils/yasheUtils';\nimport Prefix from '../../entities/shexEntities/shexUtils/prefix';\n\nimport '../../css/Yashe.css';\nimport '../../css/themes/author.css';\nimport '../../css/themes/author-dark.css';\n\nconst ERROR_EDITOR_MSG = 'Ops... There are some errors in the editor';\nconst COMPLEX_SHAPE_MSG = 'Sorry that Shape is too complex for me';\n\nfunction EditorComp() {\n\n    const [yashe,setYashe] = useState(null);\n    const divRef = useRef(null);\n    const context = useContext(AppContext);\n    let oldShapes = [];\n    let isComplex = false;\n    \n\n    const defaultPrefixes = [\n                new Prefix('','http://example.org/',0),\n                new Prefix('schema','http://schema.org/',1),\n                new Prefix('xsd','http://www.w3.org/2001/XMLSchema#',2)\n    ]\n\n    useEffect(() => {\n    \n        if (!yashe) {\n            const options = {\n                persistent:false,\n                lineNumbers: true,\n                showTooltip:true,\n                theme:'author-dark',\n                value:yasheUtils.DEFAULT_SHAPE\n            }\n            \n            const y = YASHE(divRef.current,options);\n\n            \n            y.on('humanEvent', function(shapes,width) {\n                Editor.getInstance().draw(shapes);\n                //console.log(shapes)\n                isComplex=false;\n                oldShapes = shapes;\n                let data={size:{width:width}};\n                context.handleResize(null,data);\n            });\n\n            y.on('convert',function(){\n                if(!y.hasErrors(y)){\n                    hideError();\n                    updateAssist();\n                }else{\n                    hideError();\n                    hideConvert();\n                    loading();\n                    setTimeout(function() {\n                        loaded();  \n                        showConvert();\n                        showError(ERROR_EDITOR_MSG);\n                    },500) \n                }\n            })\n\n            //When the sinc is activated we activate the appropriate handlers \n            //Otherwise it will be desactivated\n            y.on('sinc', function(sinc) {\n                if(sinc){\n                    y._handlers.focus = null;\n                    hideConvert();\n                    if(isComplex)showError(COMPLEX_SHAPE_MSG);\n                    if(y.hasErrors(y))showError(ERROR_EDITOR_MSG);\n        \n                    y.on('keyup',yasheUtils.debounce(function( e ) {\n                        if(!y.hasErrors(y)){\n                            hideError();\n                            let newShapes = getNewShapes();\n                            if(oldShapes.length == newShapes.length){ //Any new shape?\n                                if(newShapes.toString()!=oldShapes.toString()){ //Any cupdate?\n                                    isComplex=false;\n                                    oldShapes = replaceShapes(newShapes);\n                                }\n                            }else{\n                                updateAssist();\n                            } \n                        }else{\n                            showError(ERROR_EDITOR_MSG);\n                        }   \n                    }, 500));\n\n                     //Fired after a key is handled through a key map\n                    //(for example \"Ctrl-Z\")\n                    y.on('keyHandled', function() {\n                        if(!y.hasErrors()){\n                            isComplex=false;\n                            oldShapes = replaceShapes(getNewShapes());\n                            updatePrefixes(getNewPrefixes());\n                        }\n                    }); \n\n\n                }else{\n                    //Not really elegant I know     \n                    y._handlers.keyup = null; \n                    y._handlers.keyHandled = null; \n                    if(y.hasErrors(y))showConvert();\n                    if(isComplex)showConvert();\n                    y.on('focus', function() {\n                       showConvert();\n                    });       \n                }\n                \n            });\n\n            y.on('prefixChange', function(prefixes,width) {\n                Editor.getInstance().draw(oldShapes,prefixes);\n                let data={size:{width:width}};\n                context.handleResize(null,data);\n            });\n\n            y.on('forceError', function(prefixes) {\n                isComplex=true;\n                hideError();\n                loading();\n                setTimeout(function() {\n                    loaded(); \n                    showError(COMPLEX_SHAPE_MSG);\n                    if(!DEFAULTS.sincronize)showConvert();\n                },500)\n            });\n\n            y.on('delete', function() {\n                isComplex=false;\n                oldShapes = replaceShapes(getNewShapes());\n                updatePrefixes(defaultPrefixes);\n            });\n\n            y.on('upload', function() {\n                if(!y.hasErrors()){                   \n                    updateAssist();\n                    updatePrefixes(getNewPrefixes());\n                }\n            });\n\n        \n\n            //Load example from Galery\n            y.on('galery', function() {\n                if(!y.hasErrors()){                   \n                    updateAssist();\n                    updatePrefixes(getNewPrefixes());\n                }\n            });\n\n        \n            y.refresh();\n            setYashe(y);\n            \n            Editor.getInstance().setYashe(y);\n\n            oldShapes = replaceShapes(getNewShapes());\n            updatePrefixes(defaultPrefixes)\n\n            CodeMirror.signal(Editor.getInstance().getYashe(),'sinc',DEFAULTS.sincronize);\n        }\n    }, [yashe]\n    );\n\n    \n\n    const getNewShapes = function() {\n        return yasheUtils.replaceShapes();\n    }\n\n    const getNewPrefixes = function() {\n        return yasheUtils.updatePrefixes();\n    }\n\n    const replaceShapes = (newShapes)=>{\n        context.replaceShapes(newShapes);\n        return newShapes;\n    }\n\n    const updatePrefixes = (newPrefixes)=>{\n        context.replacePrefixes(newPrefixes);\n        return newPrefixes;\n    }\n\n\n    const updateAssist = function(){\n        hideConvert();\n        loading();\n        setTimeout(function() {\n            isComplex=false;  \n            oldShapes = replaceShapes(getNewShapes());                \n            loaded();\n        },500)\n    }\n\n\n     const animate = function(before1,after1,before2,after2){\n        let e1 = document.getElementsByClassName(before1)[0];\n        if(e1) e1.className = after1;\n        let e2 = document.getElementsByClassName(before2)[0];\n        if(e2) e2.className = after2;\n     }\n\n    const loading = function(){\n        animate('showAsist','hideAsist','hideLoader','showLoader');\n    }\n\n    const loaded = function(){\n         animate('showLoader','hideLoader','hideAsist','showAsist');\n    }\n\n    const showError = function(err){\n        animate('hideError','showError','showAsist','hideAsist');\n        document.getElementsByClassName('errorMsg')[0].textContent = err;\n    }\n\n    const showConvert = function(err){\n        animate('hideConvert','showConvert','showAsist','hideAsist');\n    }\n\n    const hideError = function(){\n        animate('showError','hideError','hideAsist','showAsist');\n    }\n\n    const hideConvert = function(){\n        animate('showConvert','hideConvert','hideAsist','showAsist');\n    }\n\n\n    return  (<div className=\"col edit\" ref={divRef}/>);\n\n}\n\n   \nexport default EditorComp;\n\n"]},"metadata":{},"sourceType":"module"}